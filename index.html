<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>✨ فروشگاه دامنه | ثبت سفارش آسان!</title>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <style>
    :root {
      --primary: #1d4ed8;
      --primary-light: #2563eb;
      --accent: #ea580c;
      --accent-light: #f97316;
      --bg: #0f172a;
      --card: #1e293b;
      --text: #f8fafc;
      --text-light: #cbd5e1;
      --border: #334155;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background: var(--bg);
      color: var(--text);
      padding: 20px;
      line-height: 1.7;
      min-height: 100vh;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      margin-bottom: 30px;
      padding: 25px;
      border-radius: 20px;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      box-shadow: 0 0 25px rgba(234, 88, 12, 0.4);
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    .support-link {
      display: inline-block;
      margin-top: 10px;
      color: white;
      text-decoration: none;
      font-weight: bold;
      background: rgba(0,0,0,0.2);
      padding: 6px 16px;
      border-radius: 20px;
      backdrop-filter: blur(4px);
      border: 1px solid rgba(255,255,255,0.1);
    }

    .tabs {
      display: flex;
      gap: 12px;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 25px;
    }

    .tab-btn {
      padding: 12px 20px;
      border: none;
      border-radius: 14px;
      background: var(--card);
      color: var(--text);
      cursor: pointer;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
      border: 1px solid var(--border);
    }

    .tab-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(30, 41, 59, 0.6);
    }

    .tab-btn.active {
      background: linear-gradient(90deg, var(--primary), var(--accent));
      border: none;
      box-shadow: 0 0 15px rgba(234, 88, 12, 0.5);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
    }

    input {
      width: 100%;
      padding: 14px;
      border: 1px solid var(--border);
      border-radius: 12px;
      font-size: 16px;
      background: rgba(0,0,0,0.2);
      color: var(--text);
      transition: all 0.3s;
    }

    input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(234, 88, 12, 0.3);
    }

    .radio-group {
      display: flex;
      gap: 20px;
      margin-top: 8px;
      flex-wrap: wrap;
    }

    .radio-option {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    button {
      padding: 14px 24px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      width: 100%;
      margin-top: 10px;
      transition: all 0.3s ease;
    }

    .btn-primary {
      background: linear-gradient(90deg, var(--primary), var(--accent));
      color: white;
      box-shadow: 0 4px 15px rgba(29, 78, 216, 0.4);
    }

    .btn-primary:hover {
      transform: scale(1.03);
      box-shadow: 0 6px 20px rgba(234, 88, 12, 0.6);
    }

    .alert {
      background: rgba(234, 88, 12, 0.1);
      border: 1px solid var(--accent);
      border-radius: 14px;
      padding: 18px;
      margin: 20px 0;
      color: #fed7aa;
      font-size: 14px;
    }

    .card {
      background: var(--card);
      padding: 22px;
      border-radius: 18px;
      margin-top: 20px;
      border: 1px solid var(--border);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    .card h3 {
      margin-bottom: 15px;
      color: var(--accent);
    }

    .domain-checker {
      text-align: center;
      margin: 30px 0;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: var(--card);
      border-radius: 16px;
      overflow: hidden;
      border: 1px solid var(--border);
    }

    th, td {
      padding: 14px;
      text-align: right;
      border-bottom: 1px solid var(--border);
    }

    th {
      background: rgba(0,0,0,0.2);
      font-weight: bold;
    }

    .status-active { color: #34d399; font-weight: bold; }
    .status-inactive { color: #f87171; }

    .btn-edit, .btn-delete, .btn-toggle {
      padding: 6px 10px;
      font-size: 12px;
      margin-left: 6px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      background: var(--primary);
      color: white;
    }

    .btn-toggle {
      background: var(--accent);
    }

    .btn-delete {
      background: #dc2626;
    }

    .telegram-link {
      color: var(--accent) !important;
      text-decoration: underline !important;
    }

    footer {
      text-align: center;
      margin-top: 40px;
      color: var(--text-light);
      font-size: 14px;
    }

    footer a {
      color: var(--accent);
      text-decoration: none;
    }

    #loading {
      text-align: center;
      padding: 20px;
      color: var(--text-light);
    }

    @media (max-width: 768px) {
      .tabs { flex-direction: column; align-items: center; }
      .radio-group { flex-direction: column; gap: 12px; }
      body { padding: 15px; }
      table, thead, tbody, th, td, tr {
        display: block;
        text-align: right !important;
      }
      td { 
        text-align: right !important; 
        position: relative;
        padding-left: 50% !important;
      }
      td::before {
        content: attr(data-label) ": ";
        position: absolute;
        left: 6px;
        width: 45%;
        padding-right: 10px;
        white-space: nowrap;
        font-weight: bold;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>✨ فروشگاه دامنه ما</h1>
      <p>ثبت سفارش آسان • پشتیبانی سریع • تحویل حرفه‌ای!</p>
      <a href="https://t.me/Wolfnox69" target="_blank" class="support-link">🛟 پشتیبانی تلگرام</a>
    </header>

    <div class="tabs">
      <button class="tab-btn active" data-tab="order">📩 ثبت سفارش</button>
      <button class="tab-btn" data-tab="view">👀 مشاهده اطلاعات</button>
      <button class="tab-btn" data-tab="checker">🔍 چک کننده دامنه</button>
      <button class="tab-btn" data-tab="admin">🔒 پنل ادمین</button>
    </div>

    <!-- بخش ثبت سفارش -->
    <div id="order" class="tab-content active">
      <form id="orderForm">
        <div class="form-group">
          <label>نام و نام خانوادگی (اختیاری):</label>
          <input type="text" id="fullName" placeholder="مثلاً: علی رضایی 😊" />
        </div>
        <div class="form-group">
          <label>آیدی تلگرام برای ارتباط (الزامی):</label>
          <input type="text" id="telegramContact" placeholder="@your_id" required />
        </div>
        <div class="form-group">
          <label>آیدی تلگرام برای دریافت اطلاعات دامنه (الزامی):</label>
          <input type="text" id="telegramDomainInfo" placeholder="@your_dns_id" required />
        </div>
        <div class="form-group">
          <label>نوع سفارش:</label>
          <div class="radio-group">
            <div class="radio-option">
              <input type="radio" id="simple" name="orderType" value="simple" checked />
              <label for="simple">ساده 📦</label>
            </div>
            <div class="radio-option">
              <input type="radio" id="vip" name="orderType" value="vip" />
              <label for="vip" style="color: var(--accent);">VIP 💎</label>
            </div>
          </div>
        </div>

        <div class="alert">
          🙏 <strong>کاربر عزیز!</strong><br>
          لطفاً تا زمانی که ادمین باهات تماس بگیره، <strong>آیدی تلگرامت رو تغییر نده</strong>!<br>
          ❗ اگر آیدی‌ات رو عوض کنی و طی <strong>۳ روز</strong> به پیام ما جواب ندی، سفارشت از سیستم پاک می‌شه.<br>
          🔑 <strong>پس آیدی‌ات رو حفظ کن!</strong> در غیر این صورت، حتی نمی‌تونی اطلاعات دامنه‌ات رو ببینی 😢
        </div>

        <button type="submit" class="btn-primary">ثبت سفارش الان! 🚀</button>
      </form>
    </div>

    <!-- بخش مشاهده اطلاعات -->
    <div id="view" class="tab-content">
      <div class="card">
        <h3>👀 اطلاعات دامنه خود را ببین!</h3>
        <div class="form-group">
          <label>آیدی تلگرام اطلاعات دامنه:</label>
          <input type="text" id="viewTelegram" placeholder="@your_dns_id" />
        </div>
        <button id="viewBtn" class="btn-primary">نمایش اطلاعات 📋</button>
      </div>
      <div id="viewResult"></div>
    </div>

    <!-- بخش چک کننده دامنه -->
    <div id="checker" class="tab-content">
      <div class="domain-checker">
        <h3>🔍 چک کننده دامنه مستقل</h3>
        <p>هر دامنه‌ای رو وارد کن — وضعیتش رو برات چک می‌کنیم! 🌐</p>
        <input type="text" id="externalDomain" placeholder="example.com" />
        <button id="checkBtn" class="btn-primary">چک کن! 🔎</button>
        <p style="margin-top: 15px; color: var(--text-light);">
          این ابزار برای همه آزاده! نیازی به ثبت سفارش نیست. 😎
        </p>
      </div>
    </div>

    <!-- بخش ادمین -->
    <div id="admin" class="tab-content">
      <div class="card">
        <h3>🔒 ورود به پنل ادمین</h3>
        <input type="password" id="adminPass" placeholder="رمز ادمین" style="margin: 15px 0; width: 100%; padding: 12px; border-radius: 10px;" />
        <button id="adminLogin" class="btn-primary">ورود 🔑</button>
      </div>
      <div id="adminPanel" style="display:none;">
        <h3>📋 لیست سفارش‌ها</h3>
        <div id="adminLoading">در حال بارگذاری...</div>
        <table id="ordersTable" style="display:none;">
          <thead>
            <tr>
              <th>نام 😊</th>
              <th>تماس 📩</th>
              <th>اطلاعات 📋</th>
              <th>نوع 💎</th>
              <th>دامنه 🌐</th>
              <th>وضعیت</th>
              <th>عملیات ⚙️</th>
            </tr>
          </thead>
          <tbody id="ordersBody"></tbody>
        </table>
      </div>
    </div>

    <footer>
      <p>طراحی شده با ❤️ برای کاربرای خفن مثل تو!<br>پشتیبانی: <a href="https://t.me/Wolfnox69" target="_blank">@Wolfnox69</a> 🛟</p>
    </footer>
  </div>

  <script>
    // 🔥 جای این قسمت رو با تنظیمات واقعی Firebase عوض کن!
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      projectId: "YOUR_PROJECT",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "123456789",
      appId: "1:123456789:web:abcdef123456"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const DOMAIN_CHECKER_URL = "https://your-domain-checker.com/?q=";
    const ADMIN_PASSWORD = "admin123";

    // ========== تب‌ها ==========
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById(btn.dataset.tab).classList.add('active');
      });
    });

    // ========== ثبت سفارش ==========
    document.getElementById('orderForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      let fullName = document.getElementById('fullName').value.trim();
      const telegramContact = document.getElementById('telegramContact').value.trim();
      const telegramDomainInfo = document.getElementById('telegramDomainInfo').value.trim();
      const orderType = document.querySelector('input[name="orderType"]:checked').value;

      if (!telegramContact.startsWith('@') || !telegramDomainInfo.startsWith('@')) {
        alert("لطفاً آیدی تلگرام رو با @ شروع کنید! مثلاً: @your_id");
        return;
      }

      if (!fullName) fullName = "ناشناس";

      const now = new Date();
      const expiry = new Date();
      expiry.setFullYear(expiry.getFullYear() + 1);

      const order = {
        fullName,
        telegramContact,
        telegramDomainInfo,
        orderType,
        domain: "",
        isActive: false,
        purchaseDate: now.toISOString().split('T')[0].replace(/-/g, '/'),
        expiryDate: expiry.toISOString().split('T')[0].replace(/-/g, '/'),
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      };

      try {
        await db.collection("orders").add(order);
        alert("🎉 سفارشت با موفقیت ثبت شد!\n\n📩 به زودی از طریق تلگرام باهات تماس می‌گیریم!\n\n🛟 پشتیبانی: t.me/Wolfnox69");
        document.getElementById('orderForm').reset();
      } catch (err) {
        console.error("خطا:", err);
        alert("❌ خطایی رخ داد. لطفاً دوباره امتحان کنید.");
      }
    });

    // ========== مشاهده اطلاعات ==========
    document.getElementById('viewBtn').addEventListener('click', async () => {
      const telegram = document.getElementById('viewTelegram').value.trim();
      if (!telegram || !telegram.startsWith('@')) {
        alert("لطفاً آیدی تلگرام معتبر (با @) وارد کنید!");
        return;
      }

      try {
        const snapshot = await db.collection("orders").where("telegramDomainInfo", "==", telegram).get();
        const resultDiv = document.getElementById('viewResult');
        
        if (snapshot.empty) {
          resultDiv.innerHTML = `<div class="card" style="background: #1e1e1e; border-left: 4px solid var(--accent);"><p>😢 با این آیدی، سفارشی پیدا نشد.<br>اگر مشکل داری، <a href="https://t.me/Wolfnox69" target="_blank">با ما تماس بگیر</a>! 🛟</p></div>`;
          return;
        }

        let html = `<h3 style="margin: 20px 0; color: var(--accent);">اطلاعات سفارش شما:</h3>`;
        snapshot.forEach(doc => {
          const o = doc.data();
          const status = o.isActive ? "✅ فعال" : "⏳ در انتظار";
          html += `
            <div class="card" style="margin-bottom: 15px;">
              <p><strong>نوع سفارش:</strong> ${o.orderType === 'vip' ? '💎 VIP' : '📦 ساده'}</p>
              <p><strong>نام دامنه:</strong> ${o.domain || "هنوز تعیین نشده"}</p>
              <p><strong>تاریخ ثبت:</strong> ${o.purchaseDate}</p>
              <p><strong>تاریخ انقضا:</strong> ${o.expiryDate}</p>
              <p><strong>وضعیت:</strong> <span class="${o.isActive ? 'status-active' : 'status-inactive'}">${status}</span></p>
            </div>
          `;
        });
        resultDiv.innerHTML = html;
      } catch (err) {
        console.error("خطا:", err);
        alert("خطایی رخ داد!");
      }
    });

    // ========== چک کننده ==========
    document.getElementById('checkBtn').addEventListener('click', () => {
      const domain = document.getElementById('externalDomain').value.trim();
      if (!domain) {
        alert("لطفاً نام دامنه را وارد کنید!");
        return;
      }
      window.open(DOMAIN_CHECKER_URL + encodeURIComponent(domain), '_blank');
    });

    // ========== ورود ادمین ==========
    document.getElementById('adminLogin').addEventListener('click', () => {
      const pass = document.getElementById('adminPass').value;
      if (pass === ADMIN_PASSWORD) {
        document.getElementById('adminPanel').style.display = 'block';
        loadAdminOrders();
      } else {
        alert("❌ رمز اشتباه است!");
      }
    });

    // ========== بارگذاری سفارش‌ها برای ادمین ==========
    async function loadAdminOrders() {
      const loading = document.getElementById('adminLoading');
      const table = document.getElementById('ordersTable');
      const body = document.getElementById('ordersBody');
      
      loading.style.display = 'block';
      table.style.display = 'none';
      body.innerHTML = '';

      try {
        const snapshot = await db.collection("orders").orderBy("createdAt", "desc").get();
        snapshot.forEach(doc => {
          const o = doc.data();
          const id = doc.id;
          const statusText = o.isActive ? "✅ فعال" : "❌ غیرفعال";
          const statusClass = o.isActive ? "status-active" : "status-inactive";

          // تبدیل آیدی به لینک تلگرام (بدون @)
          const contactLink = o.telegramContact.replace('@', '');
          const infoLink = o.telegramDomainInfo.replace('@', '');

          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${o.fullName}</td>
            <td data-label="تماس"><a href="https://t.me/${contactLink}" target="_blank" class="telegram-link">${o.telegramContact}</a></td>
            <td data-label="اطلاعات"><a href="https://t.me/${infoLink}" target="_blank" class="telegram-link">${o.telegramDomainInfo}</a></td>
            <td data-label="نوع">${o.orderType === 'vip' ? '💎 VIP' : '📦 ساده'}</td>
            <td data-label="دامنه">
              <input type="text" 
                     value="${o.domain}" 
                     data-id="${id}" 
                     class="domain-input" 
                     placeholder="دامنه را وارد کنید"
                     style="width:100%; padding:6px; border-radius:4px; background:var(--card); color:var(--text); border:1px solid var(--border);">
            </td>
            <td data-label="وضعیت"><span class="${statusClass}">${statusText}</span></td>
            <td data-label="عملیات">
              <button class="btn-toggle" onclick="toggleActive('${id}', ${o.isActive})">${o.isActive ? 'غیرفعال' : 'فعال'}</button>
              <button class="btn-edit" onclick="saveDomain('${id}')">ذخیره</button>
              <button class="btn-delete" onclick="deleteOrder('${id}')">حذف</button>
            </td>
          `;
          body.appendChild(row);
        });
        loading.style.display = 'none';
        table.style.display = 'table';
      } catch (err) {
        console.error("خطا در بارگذاری:", err);
        loading.innerHTML = "❌ خطایی رخ داد!";
      }
    }

    // ========== توابع ادمین ==========
    window.toggleActive = async (id, current) => {
      try {
        await db.collection("orders").doc(id).update({ isActive: !current });
        loadAdminOrders();
      } catch (err) {
        console.error("خطا:", err);
      }
    };

    window.saveDomain = async (id) => {
      const input = document.querySelector(`.domain-input[data-id="${id}"]`);
      const domain = input.value.trim();
      if (!domain) {
        alert("لطفاً نام دامنه را وارد کنید!");
        return;
      }
      try {
        await db.collection("orders").doc(id).update({ domain });
        alert("✅ نام دامنه ذخیره شد!");
        loadAdminOrders();
      } catch (err) {
        console.error("خطا:", err);
      }
    };

    window.deleteOrder = async (id) => {
      if (!confirm("آیا مطمئنی؟ این سفارش برای همیشه پاک می‌شه!")) return;
      try {
        await db.collection("orders").doc(id).delete();
        loadAdminOrders();
      } catch (err) {
        console.error("خطا:", err);
      }
    };
  </script>
</body>
</html>
